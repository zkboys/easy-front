{"version":3,"sources":["pages/role/style.less","pages/menu/MenuSelect.jsx","pages/role/EditModal.jsx","pages/role/index.jsx"],"names":["module","exports","index","config","ajax","state","loading","menus","allMenuKeys","expandedRowKeys","columns","title","dataIndex","key","render","value","record","icon","type","url","handleSelect","selected","selectedRows","nativeEvent","props","allKeys","childrenKeys","getGenerationKeys","parentKeys","concat","filter","item","includes","reverse","forEach","pk","some","ck","push","onChange","Array","from","Set","handleSelectAll","indeterminate","k","every","this","handleSearch","setState","get","then","res","map","id","parentKey","parentId","orderedData","sort","a","b","aOrder","order","bOrder","text","menuTreeData","convertToTree","finally","others","expandable","onExpandedRowsChange","rowSelection","selectedRowKeys","onSelect","onSelectAll","getCheckboxProps","dataSource","pagination","Component","EditModal","modal","isEdit","data","fetchData","form","setFieldsValue","handleSubmit","values","successTip","ajaxMethod","put","post","ajaxUrl","onOk","formProps","labelWidth","okText","cancelText","submit","onCancel","resetFields","ref","onFinish","initialValues","name","label","required","autoFocus","UserCenter","path","deleting","visible","loadingRoleMenu","selectedKeys","selectedRoleId","undefined","width","items","onClick","e","stopPropagation","color","confirm","onConfirm","handleDelete","params","handleRowClick","del","errorTip","handleSaveRoleMenu","roleId","menuIds","style","paddingLeft","selectedRoleName","find","layout","htmlType","disabled","span","rowClassName","serialNumber","rowKey","onRow"],"mappings":"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","file":"static/js/9.a66c01de.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"root-fIjVT\",\"role-menu-tip\":\"role-menu-tip-2A5Pr\"};","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Icon } from 'src/library/components';\nimport config from 'src/commons/config-hoc';\nimport { convertToTree, getGenerationKeys } from 'src/library/utils/tree-utils';\nimport { Table } from 'src/library/components';\nimport './style.less';\n\n@config({\n    ajax: true,\n})\nexport default class index extends Component {\n    static propTypes = {\n        value: PropTypes.array,     // 选中的节点\n        onChange: PropTypes.func,   // 选择节点时，触发\n    };\n\n    state = {\n        loading: false,\n        menus: [],\n        allMenuKeys: [],\n        expandedRowKeys: [],\n    };\n\n    columns = [\n        {\n            title: '名称', dataIndex: 'text', key: 'text',\n            render: (value, record) => {\n                const { icon } = record;\n\n                if (icon) return <span><Icon type={icon}/> {value}</span>;\n\n                return value;\n            },\n        },\n        {\n            title: '类型', dataIndex: 'type', key: 'type',\n            render: (value, record) => {\n                const { url } = record;\n                if (url) return '站外菜单';\n                if (value === '1') return '站内菜单';\n                if (value === '2') return '功能';\n\n                return '菜单';\n            },\n        },\n    ];\n\n    componentDidMount() {\n        this.handleSearch();\n    }\n\n    handleSearch() {\n        this.setState({ loading: true });\n        this.props.ajax\n            .get('/menus')\n            .then(res => {\n                const menus = res.map(item => ({ key: item.id, parentKey: item.parentId, ...item }));\n                const allMenuKeys = menus.map(item => item.key);\n                // 菜单根据order 排序\n                const orderedData = [ ...menus ].sort((a, b) => {\n                    const aOrder = a.order || 0;\n                    const bOrder = b.order || 0;\n\n                    // 如果order都不存在，根据 text 排序\n                    if (!aOrder && !bOrder) {\n                        return a.text > b.text ? 1 : -1;\n                    }\n\n                    return bOrder - aOrder;\n                });\n\n                const menuTreeData = convertToTree(orderedData);\n\n                // 默认展开全部\n                const expandedRowKeys = menus.map(item => item.key);\n                this.setState({ menus: menuTreeData, allMenuKeys, expandedRowKeys });\n            })\n            .finally(() => this.setState({ loading: false }));\n\n    }\n\n\n    handleSelect = (record, selected, selectedRows, nativeEvent) => {\n        const { value = [] } = this.props;\n        const { menus } = this.state;\n\n        const { key } = record;\n\n        let allKeys = [ ...value ];\n\n        // 全选 取消 子级\n        const childrenKeys = getGenerationKeys(menus, key);\n        const { parentKeys = [] } = record;\n        if (selected) {\n            // 子级全部加入\n            allKeys = allKeys.concat(key, ...childrenKeys);\n\n            // 父级状态 全部加入\n            allKeys = allKeys.concat(...parentKeys);\n        } else {\n            // 子级全部删除\n            allKeys = allKeys.filter(item => !(([ key, ...childrenKeys ]).includes(item)));\n\n            // 判断父级状态 只要有后代选中就加入\n            parentKeys.reverse().forEach(pk => {\n                const cKs = getGenerationKeys(menus, pk);\n                const hasChildSelected = cKs.some(ck => allKeys.includes(ck));\n\n                if (hasChildSelected) {\n                    allKeys.push(pk);\n                } else {\n                    allKeys = allKeys.filter(item => item !== pk);\n                }\n            });\n        }\n\n        const { onChange } = this.props;\n\n        onChange && onChange(Array.from(new Set(allKeys)));\n    };\n\n    handleSelectAll = (selected) => {\n        const { allMenuKeys } = this.state;\n        const { onChange } = this.props;\n\n        onChange && onChange(selected ? allMenuKeys : []);\n    };\n\n    indeterminate = (record) => {\n        const { value } = this.props;\n        const { menus } = this.state;\n        const { key } = record;\n        // 如果 部分子级被选中，就是半选\n        const childrenKeys = getGenerationKeys(menus, key);\n        return value.includes(key) && value.some(k => childrenKeys.includes(k)) && !childrenKeys.every(k => value.includes(k));\n    };\n\n    render() {\n        const {\n            menus,\n            loading,\n            expandedRowKeys,\n        } = this.state;\n\n        const { value, onChange, ...others } = this.props;\n\n        return (\n            <Table\n                expandable={{\n                    expandedRowKeys: expandedRowKeys,\n                    onExpandedRowsChange: expandedRowKeys => this.setState({ expandedRowKeys }),\n                }}\n                rowSelection={{\n                    selectedRowKeys: value,\n                    onSelect: this.handleSelect,\n                    onSelectAll: this.handleSelectAll,\n                    getCheckboxProps: record => {\n                        const indeterminate = this.indeterminate(record);\n                        return { indeterminate };\n                    },\n                }}\n                loading={loading}\n                columns={this.columns}\n                dataSource={menus}\n                pagination={false}\n                {...others}\n            />\n        );\n    }\n}\n\n","import React, { Component } from 'react';\nimport { Form } from 'antd';\nimport { FormElement } from 'src/library/components';\nimport config from 'src/commons/config-hoc';\nimport { ModalContent } from 'src/library/components';\n\n@config({\n    ajax: true,\n    modal: {\n        title: props => props.isEdit ? '修改' : '添加',\n    },\n})\nexport default class EditModal extends Component {\n    state = {\n        loading: false,     // 页面加载loading\n        data: {},           // 回显的角色数据\n    };\n\n    componentDidMount() {\n        const { isEdit } = this.props;\n\n        if (isEdit) {\n            this.fetchData();\n        }\n    }\n\n    fetchData = () => {\n        if (this.state.loading) return;\n\n        const { id } = this.props;\n\n        this.setState({ loading: true });\n        this.props.ajax.get(`/roles/${id}`)\n            .then(res => {\n                this.setState({ data: res || {} });\n                this.form.setFieldsValue(res);\n            })\n            .finally(() => this.setState({ loading: false }));\n    };\n\n    handleSubmit = (values) => {\n        if (this.state.loading) return;\n\n        const { isEdit } = this.props;\n        const successTip = isEdit ? '修改成功！' : '添加成功！';\n        const ajaxMethod = isEdit ? this.props.ajax.put : this.props.ajax.post;\n        const ajaxUrl = isEdit ? `/roles/${values.id}` : '/roles';\n\n        this.setState({ loading: true });\n        ajaxMethod(ajaxUrl, values, { successTip })\n            .then(() => {\n                const { onOk } = this.props;\n                onOk && onOk();\n            })\n            .finally(() => this.setState({ loading: false }));\n    };\n\n    render() {\n        const { isEdit } = this.props;\n        const { loading, data } = this.state;\n        const formProps = {\n            labelWidth: 100,\n        };\n        return (\n            <ModalContent\n                loading={loading}\n                okText=\"保存\"\n                cancelText=\"重置\"\n                onOk={() => this.form.submit()}\n                onCancel={() => this.form.resetFields()}\n            >\n                <Form\n                    ref={form => this.form = form}\n                    onFinish={this.handleSubmit}\n                    initialValues={data}\n                >\n                    {isEdit ? <FormElement {...formProps} type=\"hidden\" name=\"id\"/> : null}\n                    <FormElement\n                        {...formProps}\n                        label=\"角色名称\"\n                        name=\"name\"\n                        required\n                        autoFocus\n                    />\n                    <FormElement\n                        {...formProps}\n                        label=\"描述\"\n                        name=\"description\"\n                    />\n                </Form>\n            </ModalContent>\n        );\n    }\n}\n","import React, { Component } from 'react';\nimport { Button, Form, Row, Col } from 'antd';\nimport PageContent from 'src/layouts/page-content';\nimport config from 'src/commons/config-hoc';\nimport MenuSelect from 'src/pages/menu/MenuSelect';\nimport {\n    QueryBar,\n    FormRow,\n    FormElement,\n    Table,\n    Operator,\n} from 'src/library/components';\nimport EditModal from './EditModal';\nimport './style.less';\n\n@config({\n    path: '/roles',\n    ajax: true,\n})\nexport default class UserCenter extends Component {\n    state = {\n        loading: false,     // 表格加载数据loading\n        dataSource: [],     // 表格数据\n        deleting: false,    // 删除中loading\n        visible: false,     // 添加、修改弹框\n        id: null,           // 需要修改的数据id\n        loadingRoleMenu: false, // 查询角色权限 loading标识\n        selectedKeys: [],   // 角色对应的菜单\n        selectedRoleId: undefined, // 当前选中角色\n    };\n\n    columns = [\n        { title: '角色名称', dataIndex: 'name', width: 150 },\n        { title: '描述', dataIndex: 'description' },\n        {\n            title: '操作', dataIndex: 'operator', width: 100,\n            render: (value, record) => {\n                const { id, name } = record;\n                const items = [\n                    {\n                        label: '修改',\n                        onClick: (e) => {\n                            e.stopPropagation();\n                            this.setState({ visible: true, id });\n                        },\n                    },\n                    {\n                        label: '删除',\n                        color: 'red',\n                        confirm: {\n                            title: `您确定删除\"${name}\"?`,\n                            onConfirm: (e) => {\n                                e.stopPropagation();\n                                this.handleDelete(id);\n                            },\n                        },\n                    },\n                ];\n\n                return <Operator items={items}/>;\n            },\n        },\n    ];\n\n    componentDidMount() {\n        this.handleSearch();\n    }\n\n    handleSearch = (values) => {\n        if (this.state.loading) return;\n        const params = {\n            ...values,\n        };\n\n        // 一般系统中，角色不会太多，不做分页查询了\n        this.setState({ loading: true });\n        this.props.ajax.get('/roles', params)\n            .then(res => {\n                const dataSource = res || [];\n\n                this.setState({ dataSource });\n\n                // 查询之后，默认选中第一个角色\n                if (dataSource[0]) this.handleRowClick(dataSource[0]);\n            })\n            .finally(() => this.setState({ loading: false }));\n    };\n\n    handleDelete = (id) => {\n        if (this.state.deleting) return;\n\n        this.setState({ deleting: true });\n        this.props.ajax.del(`/roles/${id}`, null, { successTip: '删除成功！', errorTip: '删除失败！' })\n            .then(() => this.form.submit())\n            .finally(() => this.setState({ deleting: false }));\n    };\n\n    handleRowClick = (record) => {\n        const { id } = record;\n        this.setState({ selectedRoleId: id, selectedKeys: [] });\n\n        // 根据id 获取 role对应的菜单\n        this.setState({ loadingRoleMenu: true });\n        this.props.ajax.get(`/roles/${id}`)\n            .then(res => {\n                const selectedKeys = (res?.menus || []).map(item => item.id);\n                this.setState({ selectedKeys: selectedKeys });\n            })\n            .finally(() => this.setState({ loadingRoleMenu: false }));\n    };\n\n    handleSaveRoleMenu = () => {\n        const { selectedKeys, selectedRoleId } = this.state;\n        const params = { roleId: selectedRoleId, menuIds: selectedKeys };\n\n        this.setState({ loading: true });\n        this.props.ajax.put('/relateRoleMenus', params, { successTip: '保存角色权限成功！' })\n            .then(res => {\n\n            })\n            .finally(() => this.setState({ loading: false }));\n    };\n\n    render() {\n        const {\n            loading,\n            dataSource,\n            visible,\n            id,\n            selectedRoleId,\n            selectedKeys,\n            loadingRoleMenu,\n        } = this.state;\n\n        const { form } = this.props;\n        const formProps = {\n            form,\n            width: 220,\n            style: { paddingLeft: 16 },\n        };\n\n        const selectedRoleName = dataSource.find(item => item.id === selectedRoleId)?.name;\n\n        return (\n            <PageContent styleName=\"root\" loading={loading || loadingRoleMenu}>\n                <QueryBar>\n                    <Form onFinish={this.handleSearch} ref={form => this.form = form}>\n                        <FormRow>\n                            <FormElement\n                                {...formProps}\n                                label=\"角色名\"\n                                name=\"name\"\n                            />\n                            <FormElement layout>\n                                <Button type=\"primary\" htmlType=\"submit\">查询</Button>\n                                <Button onClick={() => this.form.resetFields()}>重置</Button>\n                                <Button type=\"primary\" onClick={() => this.setState({ visible: true, id: null })}>添加</Button>\n                            </FormElement>\n                            <div styleName=\"role-menu-tip\">\n                                {selectedRoleName ? <span>当前角色权限：「{selectedRoleName}」</span> : <span>请在左侧列表中选择一个角色！</span>}\n                                <Button disabled={!selectedRoleName} type=\"primary\" onClick={this.handleSaveRoleMenu}>保存权限</Button>\n                            </div>\n                        </FormRow>\n                    </Form>\n                </QueryBar>\n                <Row>\n                    <Col span={14}>\n                        <Table\n                            rowClassName={record => {\n                                if (record.id === selectedRoleId) return 'role-table selected';\n\n                                return 'role-table';\n                            }}\n                            serialNumber\n                            columns={this.columns}\n                            dataSource={dataSource}\n                            rowKey=\"id\"\n                            onRow={(record, index) => {\n                                return {\n                                    onClick: () => this.handleRowClick(record, index),\n                                };\n                            }}\n                        />\n                    </Col>\n                    <Col span={10}>\n                        <MenuSelect\n                            value={selectedKeys}\n                            onChange={selectedKeys => this.setState({ selectedKeys })}\n                        />\n                    </Col>\n                </Row>\n                <EditModal\n                    visible={visible}\n                    id={id}\n                    isEdit={id !== null}\n                    onOk={() => this.setState({ visible: false }, this.form.submit)}\n                    onCancel={() => this.setState({ visible: false })}\n                />\n            </PageContent>\n        );\n    }\n}\n"],"sourceRoot":""}