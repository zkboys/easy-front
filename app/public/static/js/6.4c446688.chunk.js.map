{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","../delegated 2887 from dll-reference reactVendor_b6b7128cced73957afbe","components/batch-delete-confirm/index.jsx","pages/users/default_avatar.jpeg","pages/users/useApi.js","pages/users/EditModal.jsx","pages/users/index.jsx"],"names":["module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","__webpack_require__","batchDeleteConfirm","count","content","style","padding","color","fontSize","confirm","title","icon","okType","onOk","onCancel","ajax","successTip","errorTip","config","modal","props","isEdit","useState","data","setData","id","useForm","form","useGet","loading","fetchUser","usePost","saving","saveUser","usePut","updating","updateUser","a","res","password","setFieldsValue","values","ajaxMethod","useEffect","fetchData","formProps","labelWidth","modalLoading","okText","cancelText","submit","resetFields","onFinish","initialValues","type","name","label","required","noSpace","autoFocus","email","path","condition","pageSize","pageNum","setCondition","dataSource","setDataSource","selectedRowKeys","setSelectedRowKeys","total","setTotal","visible","setVisible","setId","roleOptions","setRoleOptions","fetchUsers","api","deleting","deleteUsers","useDel","deletingOne","deleteUser","syncing","syncWeChatUsers","fetchRolesLoading","fetchRoles","relateRole","handleRolesChange","roleIds","record","userId","roles","map","find","item","columns","dataIndex","width","render","avatar","defaultAvatar","src","alt","height","marginRight","borderRadius","recode","mode","allowClear","showSearch","optionFilterProp","onChange","ids","options","placeholder","items","onClick","onConfirm","handleDelete","handleSearch","params","rows","length","handleRoleChange","validateFields","pageLoading","disabledDelete","layout","htmlType","danger","disabled","rowSelection","rowKey","serialNumber","onPageNumChange","onPageSizeChange","EditModal"],"mappings":"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","file":"static/js/6.4c446688.chunk.js","sourcesContent":["module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","module.exports = (__webpack_require__(6))(2887);","import React from 'react';\nimport {Modal} from 'antd';\nimport {ExclamationCircleOutlined} from '@ant-design/icons';\n\nexport default function batchDeleteConfirm(count) {\n    const content = (\n        <div>\n            您确定删除\n            <span style={{padding: '0 5px', color: 'red', fontSize: 18}}>\n                {count}\n            </span>\n            条记录吗？\n        </div>\n    );\n    return new Promise((resolve, reject) => {\n        Modal.confirm({\n            title: '温馨提示',\n            content,\n            icon: <ExclamationCircleOutlined/>,\n            okType: 'danger',\n            onOk: () => resolve(true),\n            onCancel: () => reject('user cancel confirm'),\n        });\n    });\n}\n","module.exports = \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxIPEQ8NDxAQDg4ODQ0NEBAODQ8PEA0QFRIWFhURExUYHSggGBolGxMTITEhJSkrLi4uFx8zODMsNygtLisBCgoKBQUFDgUFDisZExkrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrK//AABEIAOEA4QMBIgACEQEDEQH/xAAaAAEAAgMBAAAAAAAAAAAAAAAAAQQCAwUH/8QAKhABAQABAgUCBQUBAAAAAAAAAAECAxEEITFBURJhMnGBobFCcpHB0SL/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A9dAAAAAAAAAAAAAAAAAAAAAAAAAATEJgLgAKQAAAAAAAAAAAAAAAAAAAAAAAAACYhMBcABSAAAAAAAAAAN2elpXLpynlc09CY9t75oKeOllek+tZzhcvb+V4BRvC5eZ92OWjlO2/ydABy9x0stOXrJfnGu8Lje23yuwKIt3g55qvracxsktvegwAAAAAATEJgLgJBRAAAAAAAAbdDR9V5/DPu14472Sd3Rwx2kk7AmTblEgAAAAAADXranplu26hbvd71rpWOfrafpu3brAYAAAAAAJiEwFwAFIAAAAAAAFngsOuX0i208LjtjP5bgAAAAAAAAFfjMN8d++PP6d1hjnN5Z5mwOaEAAAAAExCYC4ACkAAAAAAUKDo6Pw4/tn4ZsNL4cf2z8MwAAAAAAAAAAcv/Q/2gAAAACYhMBcABSAAAAAAbtLh7lN7dp92mujo/Dj+2fgGWE2kniSJAAAAAAAAAAAFPU4WznLv32qu6jmXrfmCAAAAExCYC4ACkAAAAAAt8Hny9PefhUTjltZZ2B0hjhnvN4yAAAAAAAAAAtBr4jU9Mt79IoRnranqu/adGAAAAACYhMBcABSAAAAAAABno6vovtesX5d+flzVrg9Tl6e8/ALIAAAAAAAClxOt6v8AmdO/uscRqeme95RRgAAAAAACYhMBcABSAAAAAAAATjltZlOsQA6OnnMpvGTn6Opcby6Wzef26AAAAABbtzFPitXe3HtOvuDXq6nqu/adGAAAAAAAAJiEwFwAFIAAAAAAAAADx85+XTihoYerKeJzq+AAAAA5+v8AFl83QU+L09r6u15UGgAAAAAAABMQmAuAApAAAAAABazw0ssuk+tBg2aWjcvbHz5WNPhZOd/6v2bwY4YTGbRkAAAAACLN0gKetw9nPHnPHeNErptWrw8y59L5gKI2Z6GWPvPZr3AAAAATEJgLgAKQAAM9LSuXTlPIMG7T4a3ryn3WdLRmPTr5bAa9PRxx6Tn5vVsAAAAAAAAAAAAABhnpzLrN2YCpqcLf036Vos25WbX3dJjnhMuVm4OcNuroXHnOc/DUAmITAXAAUgbeH0fVzvSfcE6Gh6ud5T8rsm3JACRACRACRACRACRACRACRACRACRACRACVXiOH74/WeVkBzZUxY4nR/VPrPKviC4AClV7h/hnySAzAAAAAAAAAAAAAAAAAAAAAAAAvf5Obj/YAugA/9k=\"","import * as ajax from 'src/commons/ajax';\n\n/*\n* TODO\n* 三种写法：字符串、对象、函数\n*   最终都会转化为函数\n*\n* 简化写法：\n* 方法命名，推导出 http method :\n*   getXxx -> get\n*   deleteXxx -> del\n*   saveXxx -> post\n*   updateXxx -> put\n*\n{\n    getUser: '/users',\n    deleteUser: '/users/:id',\n    saveUser: '/users',\n    updateUser: '/users',\n\n    login: {\n        method: 'post', // 默认get\n        url: '/login',\n        options: {successTip: '登录成功'},\n    }\n}\n*\n* 基于 swagger 生成 api sdk\n*\n* api提供hooks版本，和 基础 promise版本\n* getUser: (hook = true) => hook ? useGet(...) : (params, options) => ajax.get('/users', params, options)\n* */\n\nexport default {\n    getUser: () => ajax.useGet('/mock/users'),\n    deleteUser: () => ajax.useDel('/mock/users/:id', {successTip: '删除成功！', errorTip: '删除失败！'}),\n    deleteUsers: () => ajax.useDel('/mock/users', {successTip: '删除成功！', errorTip: '删除失败！'}),\n};\n","import React, { useState, useEffect } from 'react';\nimport { Form } from 'antd';\nimport { FormElement } from 'src/library/components';\nimport config from 'src/commons/config-hoc';\nimport { ModalContent } from 'src/library/components';\nimport { useGet, usePost, usePut } from 'src/commons/ajax';\n\nexport default config({\n    modal: props => props.isEdit ? '修改用户' : '添加用户',\n})(props => {\n    const [ data, setData ] = useState({});\n    const { isEdit, id, onOk } = props;\n    const [ form ] = Form.useForm();\n    const [ loading, fetchUser ] = useGet('/users/:id');\n    const [ saving, saveUser ] = usePost('/register', { successTip: '添加成功！' });\n    const [ updating, updateUser ] = usePut('/users/:id', { successTip: '修改成功！' });\n\n    async function fetchData() {\n        if (loading) return;\n        const res = await fetchUser(id);\n\n        if (isEdit) res.password = undefined;\n        setData(res || {});\n        form.setFieldsValue(res || {});\n    }\n\n    async function handleSubmit(values) {\n        if (saving || updating) return;\n\n        const ajaxMethod = isEdit ? updateUser : saveUser;\n        await ajaxMethod(values);\n\n        onOk && onOk();\n    }\n\n    useEffect(() => {\n        if (isEdit) fetchData();\n    }, []);\n\n    const formProps = {\n        labelWidth: 100,\n    };\n    const modalLoading = loading || saving || updating;\n    return (\n        <ModalContent\n            loading={modalLoading}\n            okText=\"保存\"\n            cancelText=\"重置\"\n            onOk={() => form.submit()}\n            onCancel={() => form.resetFields()}\n        >\n            <Form\n                form={form}\n                onFinish={handleSubmit}\n                initialValues={data}\n            >\n                {isEdit ? <FormElement {...formProps} type=\"hidden\" name=\"id\"/> : null}\n\n                <FormElement\n                    {...formProps}\n                    label=\"账号\"\n                    name=\"account\"\n                    required\n                    noSpace\n                    autoFocus\n                />\n                <FormElement\n                    {...formProps}\n                    label=\"姓名\"\n                    name=\"name\"\n                    required\n                />\n                <FormElement\n                    {...formProps}\n                    type=\"password\"\n                    label=\"密码\"\n                    name=\"password\"\n                />\n                <FormElement\n                    {...formProps}\n                    label=\"邮箱\"\n                    name=\"email\"\n                    email\n                />\n            </Form>\n        </ModalContent>\n    );\n});\n\n\n","import React, { useEffect, useState } from 'react';\nimport { Button, Form, Modal, Select } from 'antd';\n\nimport PageContent from 'src/layouts/page-content';\nimport config from 'src/commons/config-hoc';\nimport batchDeleteConfirm from 'src/components/batch-delete-confirm';\nimport { useGet, useDel, usePost, usePut } from 'src/commons/ajax';\nimport api from './useApi';\nimport {\n    FormElement,\n    FormRow,\n    Operator,\n    Pagination,\n    QueryBar,\n    Table,\n} from 'src/library/components';\n\nimport EditModal from './EditModal';\nimport defaultAvatar from './default_avatar.jpeg';\n\nexport default config({\n    path: '/users',\n    title: '用户管理',\n})(() => {\n    // 数据定义\n    const [ { condition, pageSize, pageNum }, setCondition ] = useState({ condition: {}, pageSize: 20, pageNum: 1 });\n    const [ dataSource, setDataSource ] = useState([]);\n    const [ selectedRowKeys, setSelectedRowKeys ] = useState([]);\n    const [ total, setTotal ] = useState(0);\n    const [ visible, setVisible ] = useState(false);\n    const [ id, setId ] = useState(null);\n    const [ roleOptions, setRoleOptions ] = useState([]);\n    const [ form ] = Form.useForm();\n\n    // 请求相关定义 只是定义，不会触发请求，调用相关函数，才会触发请求\n    const [ loading, fetchUsers ] = useGet('/users');\n    const [ deleting, deleteUsers ] = api.deleteUsers(); // 可以单独封装成api\n    const [ deletingOne, deleteUser ] = useDel('/users/:id', { successTip: '删除成功！', errorTip: '删除失败！' });\n    const [ syncing, syncWeChatUsers ] = usePost('/syncWeChat', { successTip: '同步成功！', errorTip: '同步失败！' });\n    const [ fetchRolesLoading, fetchRoles ] = useGet('/roles');\n    const [ , relateRole ] = usePut('/relateUserRoles');\n\n    const handleRolesChange = async (roleIds, record) => {\n        const userId = record.id;\n\n        await relateRole({ userId, roleIds });\n\n        const roles = roleIds.map(id => {\n            const name = roleOptions.find(item => item.value === id)?.label;\n            return { id, name };\n        });\n\n        const data = dataSource.find(item => item.id === record.id);\n        if (data) data.roles = roles;\n\n        setDataSource([ ...dataSource ]);\n    };\n\n    const columns = [\n        {\n            title: '用户名', dataIndex: 'name', width: 200,\n            render: (name, record) => {\n                let { avatar } = record;\n\n                if (!avatar) avatar = defaultAvatar;\n\n                return (\n                    <>\n                        <img\n                            src={avatar}\n                            alt=\"头像\"\n                            style={{\n                                width: 25,\n                                height: 25,\n                                marginRight: 8,\n                                borderRadius: '50%',\n                            }}\n                        />\n                        {name}\n                    </>\n                );\n            },\n        },\n        {\n            title: '角色', dataIndex: 'roles', width: 400,\n            render: (value, recode) => {\n                const roleIds = value.map(item => item.id);\n                return (\n                    <Select\n                        style={{ width: '100%' }}\n                        mode=\"multiple\"\n                        allowClear\n                        showSearch\n                        optionFilterProp=\"children\"\n                        value={roleIds}\n                        onChange={(ids) => handleRolesChange(ids, recode)}\n                        options={roleOptions}\n                        placeholder=\"请选择角色\"\n                    />\n                );\n            },\n        },\n        { title: '职位', dataIndex: 'position' },\n        {\n            title: '操作', dataIndex: 'operator', width: 100,\n            render: (value, record) => {\n                const { id, name } = record;\n                const items = [\n                    {\n                        label: '编辑',\n                        onClick: () => setVisible(true) || setId(id),\n                    },\n                    {\n                        label: '删除',\n                        color: 'red',\n                        confirm: {\n                            title: `您确定删除\"${name}\"?`,\n                            onConfirm: () => handleDelete(id),\n                        },\n                    },\n                ];\n\n                return <Operator items={items}/>;\n            },\n        },\n    ];\n\n    // 函数定义\n    async function handleSearch() {\n        if (loading) return;\n        const params = {\n            ...condition,\n            pageNum,\n            pageSize,\n        };\n\n        const res = await fetchUsers(params);\n\n        setDataSource(res?.rows || []);\n        setTotal(res?.count || 0);\n    }\n\n    async function handleDelete(id) {\n        if (deletingOne) return;\n\n        await deleteUser(id);\n        await handleSearch();\n    }\n\n    async function handleBatchDelete() {\n        if (deleting) return;\n\n        await batchDeleteConfirm(selectedRowKeys.length);\n\n        await deleteUsers({ ids: selectedRowKeys });\n        setSelectedRowKeys([]);\n        await handleSearch();\n    }\n\n    async function syncWeChat() {\n        if (syncing) return;\n\n        Modal.confirm({\n            title: '提示',\n            content: '您确定同步微信用户以及组织架构吗？当前数据会被覆盖，请谨慎操作！',\n            onOk: () => {\n                (async () => {\n                    await syncWeChatUsers();\n                    await handleSearch();\n                })();\n            },\n        });\n    }\n\n    // 查询条件 角色改变 触发查询\n    const handleRoleChange = async () => {\n        const condition = await form.validateFields();\n        setCondition({ condition, pageSize, pageNum: 1 });\n    };\n\n    // condition pageNum pageSize 改变触发查询\n    useEffect(() => {\n        (async () => {\n            await handleSearch();\n        })();\n    }, [\n        condition,\n        pageNum,\n        pageSize,\n    ]);\n\n    useEffect(() => {\n        (async () => {\n            const roles = await fetchRoles();\n            const roleOptions = roles.map(item => ({ value: item.id, label: item.name }));\n            setRoleOptions(roleOptions);\n        })();\n    }, []);\n\n    // jsx 用到的数据\n    const formProps = { width: 200 };\n    const pageLoading = loading\n        || deleting\n        || deletingOne\n        || syncing\n        || fetchRolesLoading;\n    const disabledDelete = !selectedRowKeys?.length || pageLoading;\n\n    return (\n        <PageContent loading={pageLoading}>\n            <QueryBar>\n                <Form form={form} onFinish={condition => setCondition({ condition, pageSize, pageNum: 1 })}>\n                    <FormRow>\n                        <FormElement\n                            {...formProps}\n                            label=\"名称\"\n                            name=\"name\"\n                        />\n                        <FormElement\n                            {...formProps}\n                            allowClear\n                            type=\"select\"\n                            label=\"角色\"\n                            name=\"roleId\"\n                            options={roleOptions}\n                            onChange={handleRoleChange}\n                        />\n                        <FormElement layout>\n                            <Button type=\"primary\" htmlType=\"submit\">查询</Button>\n                            <Button onClick={() => form.resetFields()}>重置</Button>\n                            <Button type=\"primary\" onClick={() => setVisible(true) || setId(null)}>添加</Button>\n                            <Button danger disabled={disabledDelete} onClick={handleBatchDelete}>删除</Button>\n                            <Button danger onClick={syncWeChat}>同步微信</Button>\n                        </FormElement>\n                    </FormRow>\n                </Form>\n            </QueryBar>\n            <Table\n                rowSelection={{\n                    selectedRowKeys,\n                    onChange: setSelectedRowKeys,\n                }}\n                columns={columns}\n                dataSource={dataSource}\n                rowKey=\"id\"\n                serialNumber\n                pageNum={pageNum}\n                pageSize={pageSize}\n            />\n            <Pagination\n                total={total}\n                pageNum={pageNum}\n                pageSize={pageSize}\n                onPageNumChange={pageNum => setCondition({ condition, pageSize, pageNum })}\n                onPageSizeChange={pageSize => setCondition({ condition, pageSize, pageNum: 1 })}\n            />\n            <EditModal\n                visible={visible}\n                id={id}\n                isEdit={id !== null}\n                onOk={() => setVisible(false) || handleSearch()}\n                onCancel={() => setVisible(false)}\n            />\n        </PageContent>\n    );\n});\n"],"sourceRoot":""}